<!DOCTYPE HTML>
<!--
	Stellar by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>How Long To Go?</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

	</head>
	<body class="is-preload">

			

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header" class="alt">
						<span class="logo"><img src="images/logo.svg" alt="" /></span>
						<h1>How Long To Go?</h1>
						<p>Something PhD students just need to know...</p>
						
						<!-- <br />built by <a href="https://twitter.com/ajlkn">@ajlkn</a> for <a href="https://html5up.net">HTML5 UP</a>.</p> -->
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul>
							<li><a href="#intro" class="active">Introduction</a></li>
							<li><a href="#cta">Get Started</a></li>
							<li><a href="#lead">Leaderboards</a></li>
							<!-- <li><a href="#cta">Get Started</a></li> -->
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Introduction -->
							<section id="intro" class="main">
								<div class="spotlight">
									<div class="content">
										<header class="major">
											<h2>What is How Long To Go?</h2>
										</header>
										<p>A question PhD students asks themselves more often than they should do. This simple tool means you will never forget.</p>										
										<!-- <ul class="actions">
											<li><a href="generic.html" class="button">Learn More</a></li>
										</ul> -->
									</div>
									<!-- <span class="image"><img src="images/pic01.jpg" alt="" /></span> -->
								</div>
							</section>

							<!-- Get Started -->
							<section id="cta" class="main special">
									<header class="major">
										<h2>How Long Do I Have?</h2>
										<!-- <p>Just fill in the information below to find out.</p> -->
									</header>
									<body>
											<h3>When did you start?</h3>
											<select id="daySelect" style="display: inline-block; overflow-y: scroll; width: 30%; "></select>
											<select id="monthSelect" style="display: inline-block; overflow-y: scroll; width: 30%; margin: 0"></select>
											<select id="yearSelect" style="display: inline-block; overflow-y: scroll; width: 30%; margin: 0"></select>
									
											<p></p>

											<h3>PhD Duration (Years):</h3> 
											<select id="phdLengthSelect" style="display: inline-block; overflow-y: scroll; width: 30%;"></select>

											<!-- <h3>Enter Your Name:</h3> -->
											<!-- <input type="text" style="text-align:center" name="fname" placeholder="Enter Your Name"> -->
											<p></p>

											<a id="goButton" type="button" class="button primary">GO!</a>
											
											<p></p>

											<canvas id="myChart"></canvas>

											<p></p>

											<h1 id="dayRemainResult"></h1>
											<h1 id="dayCompletedResult"></h1>

											<a id="addLeaderButton" type="button" class="button primary">Add To Leaderboard?</a>

											<!-- <div id="piechart">
												<h1 id="dayResult"></h1>
											</div> -->

									</body>


									<!-- <footer class="major">
										<ul class="actions special">
											<li>
												<a id="goButton" type="button" class="button primary">GO!</a>
											</li>
											
										</ul>
									</footer> -->
								</section>

						<!-- First Section -->
						<section id="lead" class="main special">
								<header class="major">
									<h2>Leaderboards</h2>
								</header>
								<ul class="features">
									<li>
										<!-- <span class="icon major style1 fa-code"></span> -->
										<h1>Oldest</h1>
										<!-- <p>Sed lorem amet ipsum dolor et amet nullam consequat a feugiat consequat tempus veroeros sed consequat.</p> -->
										<table id='mytable'>
											<thead>
												<tr>
													<td>Name</td><td>Days Remaining</td>
												</tr>
											</thead>
											<tbody>
												<!-- <tr>
													<td>22</td><td>333</td>
												</tr>
												<tr>
													<td>22</td><td>333</td>
												</tr> -->
											</tbody>
										</table>
									</li>
									<li>
										<!-- <span class="icon major style3 fa-copy"></span> -->
										<h1>Newest</h1>
										<!-- <p>Sed lorem amet ipsum dolor et amet nullam consequat a feugiat consequat tempus veroeros sed consequat.</p> -->
										<table id='mytable'>
												<thead>
													<tr>
														<td>Name</td><td>Days Remaining</td>
													</tr>
												</thead>
												<tbody>
													<!-- <tr>
														<td>22</td><td>333</td>
													</tr>
													<tr>
														<td>22</td><td>333</td>
													</tr> -->
												</tbody>
											</table>
									</li>
									<li>
											<!-- <span class="icon major style3 fa-copy"></span> -->
											<h1>Survivors</h1>
											<!-- <p>Sed lorem amet ipsum dolor et amet nullam consequat a feugiat consequat tempus veroeros sed consequat.</p> -->
											<table id='mytable'>
													<thead>
														<tr>
															<td>Name</td>
														</tr>
													</thead>
													<tbody>
														<!-- <tr>
															<td>22</td><td>333</td>
														</tr>
														<tr>
															<td>22</td><td>333</td>
														</tr> -->
													</tbody>
												</table>
										</li>
									<!-- <li>
										<span class="icon major style5 fa-diamond"></span>
										<h3>Dolor nullam</h3>
										<p>Sed lorem amet ipsum dolor et amet nullam consequat a feugiat consequat tempus veroeros sed consequat.</p>
									</li> -->
								</ul>
								<!-- <footer class="major">
									<ul class="actions special">
										<li><a href="generic.html" class="button">Learn More</a></li>
									</ul>
								</footer> -->
							</section>

						<!-- Second Section -->
							<!-- <section id="second" class="main special">
								<header class="major">
									<h2>Ipsum consequat</h2>
									<p>Donec imperdiet consequat consequat. Suspendisse feugiat congue<br />
									posuere. Nulla massa urna, fermentum eget quam aliquet.</p>
								</header>
								<ul class="statistics">
									<li class="style1">
										<span class="icon fa-code-fork"></span>
										<strong>5,120</strong> Etiam
									</li>
									<li class="style2">
										<span class="icon fa-folder-open-o"></span>
										<strong>8,192</strong> Magna
									</li>
									<li class="style3">
										<span class="icon fa-signal"></span>
										<strong>2,048</strong> Tempus
									</li>
									<li class="style4">
										<span class="icon fa-laptop"></span>
										<strong>4,096</strong> Aliquam
									</li>
									<li class="style5">
										<span class="icon fa-diamond"></span>
										<strong>1,024</strong> Nullam
									</li>
								</ul>
								<p class="content">Nam elementum nisl et mi a commodo porttitor. Morbi sit amet nisl eu arcu faucibus hendrerit vel a risus. Nam a orci mi, elementum ac arcu sit amet, fermentum pellentesque et purus. Integer maximus varius lorem, sed convallis diam accumsan sed. Etiam porttitor placerat sapien, sed eleifend a enim pulvinar faucibus semper quis ut arcu. Ut non nisl a mollis est efficitur vestibulum. Integer eget purus nec nulla mattis et accumsan ut magna libero. Morbi auctor iaculis porttitor. Sed ut magna ac risus et hendrerit scelerisque. Praesent eleifend lacus in lectus aliquam porta. Cras eu ornare dui curabitur lacinia.</p>
								<footer class="major">
									<ul class="actions special">
										<li><a href="generic.html" class="button">Learn More</a></li>
									</ul>
								</footer>
							</section> -->

						

					</div>

				<!-- Footer -->
					<footer id="footer">
						<section>
							<h2>Acknowledgements</h2>
							<p>Thank you to all the  Cranfield PhD students at the Shrivenham campus for their support and enthusiasm, towards the project. It has come along way from a table on a white board in office MH007.</p>
							<!-- <ul class="actions">
								<li><a href="generic.html" class="button">Learn More</a></li>
							</ul> -->
						</section>
						<section>
							<h2>Get In Touch</h2>
							<dl class="alt">
								<dt>Email</dt>
								<dd><a href="#">b.corbett@cranfield.ac.uk</a></dd>
								<dt>Github</dt>
								<dd><a href="https://github.com/brandawg/HowLongToGo/">https://github.com/brandawg/HowLongToGo/</a></dd>
							</dl>
							<!-- <ul class="icons">
								<li><a href="#" class="icon fa-twitter alt"><span class="label">Twitter</span></a></li>
								<li><a href="#" class="icon fa-facebook alt"><span class="label">Facebook</span></a></li>
								<li><a href="#" class="icon fa-instagram alt"><span class="label">Instagram</span></a></li>
								<li><a href="#" class="icon fa-github alt"><span class="label">GitHub</span></a></li>
								<li><a href="#" class="icon fa-dribbble alt"><span class="label">Dribbble</span></a></li>
							</ul> -->
						</section>
						<p class="copyright">&copy; Brandon Corbett 2019. Developed By: <a href="https://www.cranfield.ac.uk/people/brandon-corbett-15358933">Brandon Corbett</a>. Web Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

			<script>
				//Initialise Select Lists for Date Pickers
				var GoHasBeenRun = 0;
				var addLeaderButton = document.getElementById('addLeaderButton');
				var goButtonButton = document.getElementById('goButton');
				goButtonButton.onclick = Days2Go;
				addLeaderButton.onclick = Add2Leaderboard;

				var ctx = document.getElementById('myChart').getContext('2d');
				var piechart = new Chart(ctx);

				var newOption;
				var today = new Date();
				var months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
				
				var daySelect = document.getElementById("daySelect");
				var monthSelect = document.getElementById("monthSelect");
				var yearSelect = document.getElementById("yearSelect");
				var phdLengthSelect = document.getElementById("phdLengthSelect");

				for(i = 1; i < 32; i++)  {
				 	newOption = document.createElement("option"); 
				 	newOption.value = i;  
				 	newOption.text = i; 
				 	try { 
						daySelect.add(newOption); 
					} 
				 	catch (e) { 
						daySelect.appendChild(newOption);
				 	}           
				}

				for(i = 0; i < 12; i++)  {
				 	newOption = document.createElement("option"); 
				 	newOption.value = i;  
				 	newOption.text = months[i]; 
				 	try { 
						monthSelect.add(newOption); 
					} 
				 	catch (e) { 
						monthSelect.appendChild(newOption);
				 	}           
				}

				for(i = today.getFullYear(); i >= today.getFullYear()-25; i--)  {
				 	newOption = document.createElement("option"); 
				 	newOption.value = i;  
				 	newOption.text = i;
				 	try { 
						yearSelect.add(newOption); 
					} 
				 	catch (e) { 
						yearSelect.appendChild(newOption);
				 	}           
				}

				for(i = 3; i <= 8; i++) {
				 	newOption = document.createElement("option"); 
				 	newOption.value = i;  
				 	newOption.text = i; 
				 	try { 
						phdLengthSelect.add(newOption); 
					} 
				 	catch (e) { 
						phdLengthSelect.appendChild(newOption);
				 	}  
					 
					if (i < 8) {
						newOption = document.createElement("option"); 
						newOption.value = i + 0.5;  
						newOption.text = i + 0.5; 
						try { 
							phdLengthSelect.add(newOption); 
						} 
						catch (e) { 
							phdLengthSelect.appendChild(newOption);
						}    
					}       
				}


				daySelect.value = today.getDate();
				monthSelect.value = today.getMonth();

				Days2Go();

				// Load LeaderBoards
				
				var leaderboardData = [];
				var finishData = [];
				var startingData = [];
				var dayData = [];
				var survivorData = [];
				// $(document).ready(function() {
				// 	$.ajax({
				// 		type: "GET",
				// 		url: "data.txt",
				// 		dataType: "text",
				// 		success: function(data) { processData(data); }
				// 	});
				// });

				processData();

				//console.log(leaderboardData);
				

				// Populate Leaderboard
				for (var i = 0; i < leaderboardData.length; i++) {
					var item = leaderboardData[i];
					var name = item[0];
					var sDateArr = item[1].split('/');
					var sDate = new Date(sDateArr[2],sDateArr[1]-1,sDateArr[0]);
					var years = item[2];
				    //console.log(sDate);
					var days = Days2GoCalculation(sDate.getDate(),sDate.getMonth(),sDate.getFullYear(),years);

					if (days < 0){
						survivorData.push(i);
						//console.log(i);
					}
					//else{
						//dayData.push(days);
					//}
					dayData.push(days);
				}

				console.log(survivorData);
				console.log(dayData);

				var lowValues =  indexOfMin(dayData);
				var topValues =  indexOfMax(dayData);

				for (var i = 0; i < lowValues.length; i++) {
					var item = leaderboardData[lowValues[i]];
					var name = item[0];

					addRow(name,dayData[lowValues[i]],0);
				}

				for (var i = 0; i < topValues.length; i++) {
					var item = leaderboardData[topValues[i]];
					var name = item[0];

					addRow(name,dayData[topValues[i]],1);
				}

				for (var i = 0; i < survivorData.length; i++) {
					var item = leaderboardData[survivorData[i]];
					var name = item[0];

					addRow('Dr. ' + name,'',2);
				}
				
				//console.log(lowValues);

				//var topValues = indexOfMax(dayData);
				//console.log(topValues);



				//addRow('Hello','30303',0)

				// Functions
				function Add2Leaderboard(){
					console.log(GoHasBeenRun);
					if (GoHasBeenRun <= 1){
						alert('Hit Go! before you can add your result to the leaderboard.');
						return;
					}


					var daySelect = document.getElementById("daySelect").value;
					var monthSelect = document.getElementById("monthSelect").value;
					var yearSelect = document.getElementById("yearSelect").value;
					var years = document.getElementById("phdLengthSelect").value;

					//var startDate = new Date(yearSelect, monthSelect, daySelect);
					var endDay = Number(daySelect);
					if (Number(years) % 1 == 0.5)
					{
						var y = Number(years) - 0.5;
						var endYear = Number(yearSelect) + y;

						//Add 6 months extra
						var endMonth = Number(monthSelect) + 5;
						if (endMonth > 12)
						{
							var endMonth = endMonth - 12 - 1;
							var endYear = endYear + 1;
						}
					}
					else
					{
						var endYear = Number(yearSelect) + Number(years);
						var endMonth = Number(monthSelect);
					}

					var startDate = new Date(Number(yearSelect), Number(monthSelect), Number(daySelect));

					var body = 'Name: Please Enter Your Name Here' + '%0D%0A' +  'Start Date: ' + startDate.toDateString() + '%0D%0A' + 'Years: ' + years.toString() + '%0D%0A %0D%0A' + 'In doing this you are willing giving consent for your Name to be used publicly on the website https://brandawg.github.io/HowLongToGo/';
					window.open('mailto:b.corbett@cranfield.ac.uk?subject=Please add me to the leaderboard!&body='+body,'_self');

				}

				function processData() {
					var rawFile = new XMLHttpRequest();
					rawFile.open("GET", "data.txt", false);
					rawFile.onreadystatechange = function ()
					{
						if(rawFile.readyState === 4)
						{
							if(rawFile.status === 200 || rawFile.status == 0)
							{
								var allText = rawFile.responseText;

								var allTextLines = allText.split(/\r\n|\n/);

									for (var i = 0; i < allTextLines.length; i++) {
										var data = allTextLines[i].split(',');
										leaderboardData.push(data);
									}
								//alert(allText);
							}
						}
					}
					rawFile.send(null);
				}

				function getMin(data) {
					return data.reduce((min, p) => p < min ? p : min);
				}
				function getMax(data) {
					return data.reduce((max, p) => p > max ? p : max);
				}

				function indexOfMax(arr) {
					if (arr.length === 0) {
						return -1;
					}

					var s = Math.ceil((arr.length - survivorData.length) / 2);

					var max = Array(s);
					var maxIndex = Array(s);
					for (var i = 0; i < s; i++) {
						max[i] = -1;
						maxIndex[i] = -1;
					}

					for (var i = 0; i < arr.length; i++) {
						if (arr[i] < 0){
							continue;
						}

						for (var j = 0; j < max.length; j++) {
							if (arr[i] > max[j]) {
								//Shift current array items
								if (max[j] == -1)
								{
									max[j] = arr[i];
									maxIndex[j] = i;
								}
								else if (j < max.length){
									for (var n = max.length-2; n >= j; --n){

										max[n+1] = max[n];
										maxIndex[n+1] = maxIndex[n];
									}
									max[j] = arr[i];
									maxIndex[j] = i;
								}
								else{
									max[j] = arr[i];
									maxIndex[j] = i;
								}
								break;
							}
						}
					}

					console.log(max);
					console.log(maxIndex);
					return maxIndex;
				}


				function indexOfMin(arr) {
					if (arr.length === 0) {
						return -1;
					}

					// var min = [1000000,1000000,1000000,1000000,1000000];
					// var minIndex = [-1,-1,-1,-1,-1];
					var s = Math.ceil((arr.length - survivorData.length) / 2);
					var min = Array(s);
					var minIndex = Array(s);
					for (var i = 0; i < s; i++) {
						min[i] = 10000;
						minIndex[i] = -1;
					}

					for (var i = 0; i < arr.length; i++) {
						if (arr[i] < 0){
							continue;
						}
						for (var j = 0; j < min.length; j++) {
							if (arr[i] < min[j]) {
								//Shift current array items
								if (min[j] == -1)
								{
									min[j] = arr[i];
									minIndex[j] = i;
								}
								else if (j < min.length){
									for (var n = min.length-2; n >= j; --n){

										min[n+1] = min[n];
										minIndex[n+1] = minIndex[n];
									}
									min[j] = arr[i];
									minIndex[j] = i;
								}
								else{
									min[j] = arr[i];
									minIndex[j] = i;
								}
								break;
							}
						}
					}

					console.log(min);
					console.log(minIndex);
					return minIndex;
				}


				function addRow(content,morecontent,table)
				{
					if (!document.getElementsByTagName) return;
					tabBody=document.getElementsByTagName("tbody").item(table);
					row=document.createElement("tr");
					if (table < 2){
						cell1 = document.createElement("td");
						cell2 = document.createElement("td");
						textnode1=document.createTextNode(content);
						textnode2=document.createTextNode(morecontent);
						cell1.appendChild(textnode1);
						cell2.appendChild(textnode2);
						row.appendChild(cell1);
						row.appendChild(cell2);
						tabBody.appendChild(row);
					}else{
						cell1 = document.createElement("td");
						textnode1=document.createTextNode(content);
						cell1.appendChild(textnode1);
						row.appendChild(cell1);
						tabBody.appendChild(row);
					}
				}

				function Days2GoCalculation(daySelect,monthSelect,yearSelect,years)
				{
					//var daySelect = document.getElementById("daySelect").value;
					//var monthSelect = document.getElementById("monthSelect").value;
					//var yearSelect = document.getElementById("yearSelect").value;
					//var years = document.getElementById("phdLengthSelect").value;

					//var startDate = new Date(yearSelect, monthSelect, daySelect);
					var endDay = Number(daySelect);
					if (Number(years) % 1 == 0.5)
					{
						var y = Number(years) - 0.5;
						var endYear = Number(yearSelect) + y;

						//Add 6 months extra
						var endMonth = Number(monthSelect) + 5;
						if (endMonth > 12)
						{
							var endMonth = endMonth - 12 - 1;
							var endYear = endYear + 1;
						}
					}
					else
					{
						var endYear = Number(yearSelect) + Number(years);
						var endMonth = Number(monthSelect);
					}

					var startDate = new Date(Number(yearSelect), Number(monthSelect), Number(daySelect));
					var endDate = new Date(endYear, endMonth, endDay);
					var todayDate = new Date().getTime();

					var diffCompleted = today - startDate;
					var diffRemain = endDate - today;
					var daysRemain = Math.floor(diffRemain / (1000 * 60 * 60 * 24));
					var daysCompleted = Math.floor(diffCompleted / (1000 * 60 * 60 * 24));
					//var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					//var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
					//var seconds = Math.floor((diff % (1000 * 60)) / 1000);

					if (daysCompleted < 0){
						return ;
					}

					return daysRemain;

					//UpdateChart(daysCompleted, daysRemain);

					//document.getElementById("dayRemainResult").innerText = 'Days Remaining: ' + daysRemain.toString();
					//document.getElementById("dayCompletedResult").innerText = 'Days Completed: ' + daysCompleted.toString();
				}



				function Days2Go()
				{
					var daySelect = document.getElementById("daySelect").value;
					var monthSelect = document.getElementById("monthSelect").value;
					var yearSelect = document.getElementById("yearSelect").value;
					var years = document.getElementById("phdLengthSelect").value;

					//var startDate = new Date(yearSelect, monthSelect, daySelect);
					var endDay = Number(daySelect);
					if (Number(years) % 1 == 0.5)
					{
						var y = Number(years) - 0.5;
						var endYear = Number(yearSelect) + y;

						//Add 6 months extra
						var endMonth = Number(monthSelect) + 5;
						if (endMonth > 12)
						{
							var endMonth = endMonth - 12 - 1;
							var endYear = endYear + 1;
						}
					}
					else
					{
						var endYear = Number(yearSelect) + Number(years);
						var endMonth = Number(monthSelect);
					}

					var startDate = new Date(Number(yearSelect), Number(monthSelect), Number(daySelect));
					var endDate = new Date(endYear, endMonth, endDay);
					var todayDate = new Date().getTime();

					var diffCompleted = today - startDate;
					var diffRemain = endDate - today;
					var daysRemain = Math.floor(diffRemain / (1000 * 60 * 60 * 24));
					var daysCompleted = Math.floor(diffCompleted / (1000 * 60 * 60 * 24));
					//var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					//var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
					//var seconds = Math.floor((diff % (1000 * 60)) / 1000);

					if (daysCompleted < 0){
						return;
					}

					UpdateChart(daysCompleted, daysRemain);

					document.getElementById("dayRemainResult").innerText = 'Days Remaining: ' + daysRemain.toString();
					document.getElementById("dayCompletedResult").innerText = 'Days Completed: ' + daysCompleted.toString();

					GoHasBeenRun = GoHasBeenRun+1;
				}

				
				function UpdateChart(dayCompleted, dayRemain){

					piechart.destroy();

					var ctx = document.getElementById('myChart').getContext('2d');

					piechart = new Chart(ctx, {
					// The type of chart we want to create
						type: 'doughnut',

						// The data for our dataset
						data: {
							labels: ['Days Completed', 'Days to Go'],
							datasets: [{
								//label: 'My First dataset',
								backgroundColor: ['rgb(34,180,115)','rgb(250, 0, 30)'],
								//borderColor: 'rgb(255, 99, 132)',
								data: [dayCompleted, dayRemain]
							}]
						},

						// Configuration options go here
						options: {}
					});
				}

			</script>
	</body>
</html>